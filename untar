#!/usr/bin/env bash
# extract (a.k.a untar) with 7za fallback

if [ -z "$1" ]; then
    echo "Usage: extract <path/file_name>.<zip|rar|bz2|gz|tar|tbz2|tgz|Z|7z|xz|exe|tar.bz2|tar.gz|tar.xz>"
    exit 1
fi

file="$1"

if [ ! -f "$file" ]; then
    echo "$file - file does not exist"
    exit 1
fi

fallback_to_7za() {
    echo "[*] Falling back to 7za..."
    7za x -y -- "$file"
}

case "$file" in
    *.tar.bz2)   tar xvjf "$file" || fallback_to_7za ;;
    *.tar.gz)    tar xvzf "$file" || fallback_to_7za ;;
    *.tar.xz)    tar xvJf "$file" || fallback_to_7za ;;
    *.lzma)      unlzma "$file"   || fallback_to_7za ;;
    *.bz2)       bunzip2 "$file"  || fallback_to_7za ;;
    *.rar)       unrar x -ad "$file" || fallback_to_7za ;;
    *.gz)        gunzip "$file"   || fallback_to_7za ;;
    *.tar)       tar xvf "$file"  || fallback_to_7za ;;
    *.tbz2)      tar xvjf "$file" || fallback_to_7za ;;
    *.tgz)       tar xvzf "$file" || fallback_to_7za ;;
    *.zip)       unzip "$file"    || fallback_to_7za ;;
    *.Z)         uncompress "$file" || fallback_to_7za ;;
    *.7z)        7za x -y -- "$file" ;;
    *.xz)        unxz "$file"     || fallback_to_7za ;;
    *.exe)       cabextract "$file" || fallback_to_7za ;;
    *)           echo "extract: '$file' - unknown archive method, trying 7za..."
                 fallback_to_7za ;;
esac

